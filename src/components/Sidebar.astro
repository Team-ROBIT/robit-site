---
// src/components/Sidebar.astro
import { getCollection } from 'astro:content';

const allDocs = await getCollection('archive');

// 1. sidebar: false가 아닌 문서들만 먼저 걸러냅니다.
const sidebarDocs = allDocs.filter(doc => doc.data.sidebar !== false);

const groups = [
    { id: 'overview', title: 'Overview' },
    { id: 'contest', title: 'Contest' },
    { id: 'events', title: 'Events' },
    { id: 'articles', title: 'Articles' },
    { id: 'robots', title: 'Our Robots' },
    { id: 'members', title: 'People' },
    { id: 'contact', title: 'Contact' },
];

const menuItems = groups.map(group => {
    // 2. 중요: 여기서 allDocs가 아니라 'sidebarDocs'를 필터링해야 합니다!
    const items = sidebarDocs
        .filter(doc => doc.slug.startsWith(group.id)) 
        .sort((a, b) => (a.data.order || 0) - (b.data.order || 0)) 
        .map(doc => ({
            name: doc.data.title,
            href: `/robit-site/${doc.slug}`
        }));

    return {
        title: group.title,
        items: items.length > 0 ? items : [{ name: '준비 중...', href: '#' }]
    };
});
---

<nav class="space-y-6">
    {menuItems.map((group) => (
        <div>
            <h3 class="text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2 px-2">
                {group.title}
            </h3>
            <ul class="space-y-1">
                {group.items.map((item) => (
                    <li>
                        <a
                            href={item.href}
                            class="block px-2 py-1.5 text-sm text-zinc-600 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-zinc-900 hover:text-zinc-900 dark:hover:text-zinc-100 rounded-md transition-colors"
                        >
                            {item.name}
                        </a>
                    </li>
                ))}
            </ul>
        </div>
    ))}
</nav>